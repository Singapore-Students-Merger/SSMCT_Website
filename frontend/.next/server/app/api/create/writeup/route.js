(()=>{var e={};e.id=1065,e.ids=[1065],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},79748:e=>{"use strict";e.exports=require("fs/promises")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},33873:e=>{"use strict";e.exports=require("path")},11723:e=>{"use strict";e.exports=require("querystring")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},86029:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>O,routeModule:()=>_,serverHooks:()=>j,workAsyncStorage:()=>R,workUnitAsyncStorage:()=>E});var n={};r.r(n),r.d(n,{POST:()=>b});var o=r(42706),i=r(28203),u=r(45994),s=r(39187),a=r(84908),c=r(29021),l=r.n(c),d=r(33873),f=r.n(d),p=r(79748),y=r(85562),g=r(31831);let b=async e=>{try{let t=await e.formData(),r=t.get("WriteupThumbnail"),n=t.get("WriteupFile");if(!r||!n)return s.NextResponse.json({error:"Not all files received."},{status:400});let o=Buffer.from(await r.arrayBuffer()),i=r.name.replaceAll(" ","_");f().normalize(i).replace(/^(\.\.(\/|\\|$))+/,"");let u=i.substring(0,i.lastIndexOf("."));if(![".jpg",".jpeg",".png",".webp",".svg"].includes(f().extname(i)))return s.NextResponse.json({status:"error",error:"Invalid thumbnail type, we only accept jpg, jpeg, png, webp or svg"});for(;l().existsSync(f().join(process.cwd(),"/uploads/writeups/images/",i));)u+="1",i=u+f().extname(i),console.log("ALREADY EXISTING FILENAME, ATTEMPTING TO CHANGE FILENMAEEEEEE");console.log(i);let c=Buffer.from(await n.arrayBuffer()),d=n.name.replaceAll(" ","_");f().normalize(d).replace(/^(\.\.(\/|\\|$))+/,"");let b=d.substring(0,d.lastIndexOf("."));if(![".md",".markdown"].includes(f().extname(d)))return s.NextResponse.json({status:"error",error:"Invalid file type, we only accept markdown"});for(;l().existsSync(f().join(process.cwd(),"/uploads/writeups/writeup/",d));)b+="1",d=b+f().extname(d),console.log("FOR THE MD FILE FOR THE MD FILE ALREADY EXISTING FILENAME, ATTEMPTING TO CHANGE FILENMAEEEEEE #####");console.log(d),await (0,p.writeFile)(f().join(process.cwd(),"/uploads/writeups/images/"+i),o),console.log("Uploading file: ",f().join(process.cwd(),"/uploads/writeups/writeup/"+d)),await (0,p.writeFile)(f().join(process.cwd(),"/uploads/writeups/writeup/"+d),c);let _=t.get("Title"),R=t.get("Difficulty"),E=t.get("Link"),j=t.get("Category"),O=t.get("Topics"),m=t.get("CTF");if(!O||!m)return s.NextResponse.json({error:"Missing required fields."},{status:400});let v=JSON.parse(O),w=JSON.parse(m),h=t.get("Description"),P=await (0,y.j)();P||(0,g.redirect)("/auth/signin");let x=P.user.id,T=(await a.A.categories.findMany()).find(e=>e.name===j),M=w.id;if(!w.id){let e=await a.A.events.create({data:{userId:x,title:w.title,isCompetition:!0}});M=e.id,await a.A.ctf.create({data:{eventId:e.id}})}let I=await a.A.writeups.create({data:{title:_,difficulty:R,contentFile:E,description:h,categoryId:T?T.id:null,eventId:M.id,source:f().join("/uploads/writeups/writeup/"+d),thumbnail:f().join("/uploads/writeups/images/"+i),userId:x},select:{id:!0}});for(let e of v)e&&await a.A.writeupstopics.create({data:{writeupId:I.id,topicId:e}});return console.log("Success"),s.NextResponse.json({status:"success"})}catch(e){return e instanceof Error&&console.error(e.message),s.NextResponse.json({status:"error",message:"Internal Server Error"})}},_=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/create/writeup/route",pathname:"/api/create/writeup",filename:"route",bundlePath:"app/api/create/writeup/route"},resolvedPagePath:"C:\\Users\\czhon\\Documents\\GitHub\\SSMCT_Website\\frontend\\src\\app\\api\\create\\writeup\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:R,workUnitAsyncStorage:E,serverHooks:j}=_;function O(){return(0,u.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:E})}},96487:()=>{},78335:()=>{},31831:(e,t,r)=>{"use strict";var n=r(67359);r.o(n,"redirect")&&r.d(t,{redirect:function(){return n.redirect}})},46347:(e,t,r)=>{"use strict";function n(){throw Error("`forbidden()` is experimental and only allowed to be enabled when `experimental.authInterrupts` is enabled.")}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"forbidden",{enumerable:!0,get:function(){return n}}),r(26003).HTTP_ERROR_FALLBACK_ERROR_CODE,("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},26003:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{HTTPAccessErrorStatus:function(){return r},HTTP_ERROR_FALLBACK_ERROR_CODE:function(){return o},getAccessFallbackErrorTypeByStatus:function(){return s},getAccessFallbackHTTPStatus:function(){return u},isHTTPAccessFallbackError:function(){return i}});let r={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401},n=new Set(Object.values(r)),o="NEXT_HTTP_ERROR_FALLBACK";function i(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r]=e.digest.split(";");return t===o&&n.has(Number(r))}function u(e){return Number(e.digest.split(";")[1])}function s(e){switch(e){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not-found";default:return}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},11271:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isNextRouterError",{enumerable:!0,get:function(){return i}});let n=r(26003),o=r(23543);function i(e){return(0,o.isRedirectError)(e)||(0,n.isHTTPAccessFallbackError)(e)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},67359:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyURLSearchParams:function(){return l},RedirectType:function(){return o.RedirectType},forbidden:function(){return u.forbidden},notFound:function(){return i.notFound},permanentRedirect:function(){return n.permanentRedirect},redirect:function(){return n.redirect},unauthorized:function(){return s.unauthorized},unstable_rethrow:function(){return a.unstable_rethrow}});let n=r(26552),o=r(23543),i=r(39274),u=r(46347),s=r(10590),a=r(51370);class c extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class l extends URLSearchParams{append(){throw new c}delete(){throw new c}set(){throw new c}sort(){throw new c}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},39274:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"notFound",{enumerable:!0,get:function(){return o}});let n=""+r(26003).HTTP_ERROR_FALLBACK_ERROR_CODE+";404";function o(){let e=Error(n);throw e.digest=n,e}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},23543:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{REDIRECT_ERROR_CODE:function(){return o},RedirectType:function(){return i},isRedirectError:function(){return u}});let n=r(11541),o="NEXT_REDIRECT";var i=function(e){return e.push="push",e.replace="replace",e}({});function u(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let t=e.digest.split(";"),[r,i]=t,u=t.slice(2,-2).join(";"),s=Number(t.at(-2));return r===o&&("replace"===i||"push"===i)&&"string"==typeof u&&!isNaN(s)&&s in n.RedirectStatusCode}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},11541:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return r}});var r=function(e){return e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e}({});("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},26552:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{getRedirectError:function(){return u},getRedirectStatusCodeFromError:function(){return d},getRedirectTypeFromError:function(){return l},getURLFromRedirectError:function(){return c},permanentRedirect:function(){return a},redirect:function(){return s}});let n=r(19121),o=r(11541),i=r(23543);function u(e,t,r){void 0===r&&(r=o.RedirectStatusCode.TemporaryRedirect);let n=Error(i.REDIRECT_ERROR_CODE);return n.digest=i.REDIRECT_ERROR_CODE+";"+t+";"+e+";"+r+";",n}function s(e,t){let r=n.actionAsyncStorage.getStore();throw u(e,t||((null==r?void 0:r.isAction)?i.RedirectType.push:i.RedirectType.replace),o.RedirectStatusCode.TemporaryRedirect)}function a(e,t){throw void 0===t&&(t=i.RedirectType.replace),u(e,t,o.RedirectStatusCode.PermanentRedirect)}function c(e){return(0,i.isRedirectError)(e)?e.digest.split(";").slice(2,-2).join(";"):null}function l(e){if(!(0,i.isRedirectError)(e))throw Error("Not a redirect error");return e.digest.split(";",2)[1]}function d(e){if(!(0,i.isRedirectError)(e))throw Error("Not a redirect error");return Number(e.digest.split(";").at(-2))}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},10590:(e,t,r)=>{"use strict";function n(){throw Error("`unauthorized()` is experimental and only allowed to be used when `experimental.authInterrupts` is enabled.")}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"unauthorized",{enumerable:!0,get:function(){return n}}),r(26003).HTTP_ERROR_FALLBACK_ERROR_CODE,("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},51370:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"unstable_rethrow",{enumerable:!0,get:function(){return function e(t){if((0,u.isNextRouterError)(t)||(0,i.isBailoutToCSRError)(t)||(0,n.isDynamicUsageError)(t)||(0,o.isPostpone)(t))throw t;t instanceof Error&&"cause"in t&&e(t.cause)}}});let n=r(62349),o=r(67418),i=r(40627),u=r(11271);("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},62349:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isDynamicUsageError",{enumerable:!0,get:function(){return s}});let n=r(42490),o=r(40627),i=r(11271),u=r(10436),s=e=>(0,n.isDynamicServerError)(e)||(0,o.isBailoutToCSRError)(e)||(0,i.isNextRouterError)(e)||(0,u.isDynamicPostpone)(e)},37301:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return a}});let n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(void 0);if(r&&r.has(e))return r.get(e);var n={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=i?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(n,u,s):n[u]=e[u]}return n.default=e,r&&r.set(e,n),n}(r(76301));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}let i={current:null},u="function"==typeof n.cache?n.cache:e=>e,s=console.warn;function a(e){return function(...t){s(e(...t))}}u(e=>{try{s(i.current)}finally{i.current=null}})},67418:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isPostpone",{enumerable:!0,get:function(){return n}});let r=Symbol.for("react.postpone");function n(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}},40627:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{BailoutToCSRError:function(){return n},isBailoutToCSRError:function(){return o}});let r="BAILOUT_TO_CLIENT_SIDE_RENDERING";class n extends Error{constructor(e){super("Bail out to client-side rendering: "+e),this.reason=e,this.digest=r}}function o(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===r}},85562:(e,t,r)=>{"use strict";r.d(t,{$:()=>a,j:()=>c});var n=r(51825),o=r(64912),i=r(86259),u=r(84908);let s=async e=>{let t=process.env.DISCORD_GUILD_ID,r=await fetch("https://discord.com/api/v10/users/@me/guilds",{headers:{Authorization:`Bearer ${e}`}});if(!r.ok)throw console.error("Failed to fetch user's Discord guilds"),Error("Failed to fetch user's Discord guilds");return!!(await r.json()).some(e=>e.id===t)||(console.error("User is not in the required Discord guild"),!1)},a={adapter:(0,i.y)(u.A),pages:{signIn:"/",signOut:"/auth/signout",error:"/auth/signin",newUser:"/auth/new_user"},session:{strategy:"database"},providers:[(0,o.A)({clientId:process.env.DISCORD_CLIENT_ID,clientSecret:process.env.DISCORD_CLIENT_SECRET,authorization:{params:{scope:"identify guilds guilds.members.read"}},token:"https://discord.com/api/oauth2/token",userinfo:"https://discord.com/api/users/@me",profile:e=>({id:e.id,name:e.username,image:e.avatar?`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.png`:null})})],callbacks:{async signIn({account:e,user:t}){if(!e||!t)return!1;if("discord"===e.provider){if(console.log(e),!e.access_token)return!1;if(!await s(e.access_token))throw Error("User is not in the required Discord guild")}return!0},session:async({session:e,user:t})=>(e?.user&&(e.user.id=t.id),e)}};function c(...e){return(0,n.getServerSession)(...e,a)}},84908:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(96330);let o=global.prisma||new n.PrismaClient({log:["query"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,5452,6622],()=>r(86029));module.exports=n})();